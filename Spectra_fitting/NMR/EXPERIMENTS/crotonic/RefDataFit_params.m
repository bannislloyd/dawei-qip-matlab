%Matlab script allowing you to update you nuclei file from experimental data.
%datadir: nucleus directory..it''s where the new nuclei file will be stored
%expdir : where the ref experimental data is stored
%%%
%
%If you choose to optimize the j-couplings they will be updated into the new 
%nuclei file the following way:
%        -if you have optimized the same j-coupling twice,
%         (for instance C1C2 and C2C1) the new value is the average
%         of the two optimized values (i.e. JC1C2 and JC1C2)
%        -if it has been optimized only one it becomes the new value.
%
%Note: Once you are pretty sure of you Jcoupling you should run the script
%without J-optimization. It should give you nice matching peaks and its
%much faster!       
%%%

%Initialize the input outpout directories and some variables needed
%by matlab:
%Note that the guy will optimie j-coupling only if ilb=inf!!

ilb    = [inf];
ifrng  = [100];
tfrac  = [1];

% ilb    = [10,inf]; %%multiplica uma exponencial
% ifrng  = [5,1];    %% renge de frenquencia
% tfrac  = [1/4,1];

 ilb    = [inf];
 ifrng  = [100];
 tfrac  = [1];



%Number of nuclei per group:
rps    =  [3,3,1,1,1,1,1,1,1];

%To save some time:
%Set-up the whsh to take into account only the most coupled nuclei
whsh={[1,0,0,0,1,0,0,0,0],...
      [0,1,1,1,0,1,1,1,1],...
      [0,1,1,1,0,1,1,1,1],...
      [0,1,1,1,0,1,1,1,1],...
      [1,0,0,0,1,0,0,0,0],...
      [0,1,1,1,0,1,1,1,1],...
      [0,1,1,1,0,1,1,1,1],...
      [0,1,1,1,0,1,1,1,1],...
      [0,1,1,1,0,1,1,1,1]};
      
%Set-up the jopts to  optimize only the main j-coupling
%All right so first element in whjc{i} = chemicalshift of the i nucleus. (as to be one)
%Second is the biggest j-coupling that the i nucleus experiences, third is the second biggest...etc...
%note that the number of ones in whjc{a} as to be less or equal to the number of ones into the corresponding whsh: 
%if you're considering n spins, a single one can't experience more than n-1 J-coupling!! 
%and adding the one corresponding to the chemical shift gives you a maximum of n ones.

whjc={[1,0,0,0,0,0,0,0,0],...
     [1,0,0,0,0,0,0,0,0],...
     [1,0,0,0,0,0,0,0,0],...
     [1,0,0,0,0,0,0,0,0],...
     [1,0,0,0,0,0,0,0,0],...
     [1,0,0,0,0,0,0,0,0],...
     [1,0,0,0,0,0,0,0,0],...
     [1,0,0,0,0,0,0,0,0],...
     [1,0,0,0,0,0,0,0,0]};

%whjc={[1,1,0,0,0,0,0,0,0],...
%     [1,1,1,1,1,1,1,0,0],...
%     [1,1,1,1,1,1,1,0,0],...
%     [1,1,1,1,1,1,1,0,0],...
%     [1,1,0,0,0,0,0,0,0],...
%     [1,1,1,1,1,1,1,0,0],...
%     [1,1,1,1,1,1,1,0,0],...
%     [1,1,1,1,1,1,1,0,0],...
%     [1,1,1,1,1,1,1,0,0]};
        
     
%which_up =   [0,1,1,1,0,1,1,1,1];
%which_up =  [1,0,0,0,1,0,0,0,0];
which_up =  [1,0,0,0,0,0,0,0,0];